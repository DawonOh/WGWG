<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.min.edu.model.NoticeDaoImpl">
  <resultMap type="NoticeVo" id="BoardDtoMap">
		<result column="NOTICE_NO" property="notice_no"/>
		<result column="NOTICE_TITLE" property="notice_title"/>
		<result column="NOTICE_CONTENT" property="notice_content"/>
		<result column="NOTICE_REG_DT" property="notice_reg_dt"/>
		<result column="NOTICE_CHK" property="notice_chk"/>
		<result column="EMP_NO" property="emp_no"/>
		<collection property="fileVo" resultMap="FileDtoMap"/>
	</resultMap>
	
	<resultMap type="NoticeFileVO" id="FileDtoMap">
		<result column="NOTICE_FILE_NO" property="notice_file_no"/>
		<result column="NOTICE_FILE_NM" property="notice_file_nm"/>
		<result column="NOTICE_FILE_SAVE_NM" property="notice_file_save_nm"/>
		<result column="NOTICE_FILE_SIZE" property="notice_file_size"/>
		<result column="NOTICE_FILE_REG_DT" property="notice_file_reg_dt"/>
		<result column="NOTICE_NO" property="notice_no"/>
	</resultMap>
	
	<!-- 회사의 공지사항 -->
	<!-- <select id="getAllListC" resultType="NoticeVo">
		SELECT n.NOTICE_NO, n.NOTICE_TITLE, n.NOTICE_REG_DT, e.EMP_NM 
			FROM NOTICE n JOIN EMP e				
			ORDER BY n.NOTICE_NO			
	</select> -->
	
	<!-- 본인이 속한 부서의 공지사항 -->
	<!-- <select id="getdeptlist" parameterType="Integer" resultType="NoticeVo">
		SELECT n.NOTICE_NO, n.NOTICE_TITLE, n.NOTICE_REG_DT, e.EMP_NM 
			FROM NOTICE n JOIN EMP e	
			ON e.DEPT_NO = #{dept_no}
			ORDER BY n.NOTICE_NO			
	</select> -->
	<!-- 전체공지사항 -->
	<select id="getAllList" resultType="NoticeVo">
		SELECT NOTICE_NO, NOTICE_TITLE, NOTICE_REG_DT,EMP_NO
			FROM NOTICE
			ORDER BY NOTICE_NO
	</select>	
	<!-- 글입력 -->
	<insert id="insertBoard" parameterType="NoticeVo">
		INSERT INTO NOTICE (NOTICE_NO, NOTICE_TITLE, NOTICE_CONTENT,
							 NOTICE_REG_DT, NOTICE_CHK, EMP_NO)
			VALUES(NOTICE_SEQ.NEXTVAL,#{notice_title},#{notice_content},#{notice_reg_dt},SYSDATE,#{emp_no})
	</insert>
	
	<!-- 파일입력 -->
	<insert id="insertFile" parameterType="NoticeFileVo">
		INSERT INTO NOTICEFILE
			(NOTICE_FILE_NO, NOTICE_FILE_NM, NOTICE_FILE_SAVE_NM, 
			NOTICE_FILE_SIZE, NOTICE_FILE_REG_DT, NOTICE_NO)
			VALUES(NOTICEFILE_SEQ.NEXTVAL, #{notice_file_nm}, #{notice_file_save_nm},
						 #{notice_file_size}, SYSDATE,NOTICE_SEQ.CURRVAL)		
	</insert>
	<!--  글 + 파일이름 -->
	<select id="getBoard" parameterType="Integer" resultMap="FileDtoMap">
		SELECT N.NOTICE_NO,N.EMP_NO, N.NOTICE_TITLE,N.NOTICE_CONTENT,N.NOTICE_REG_DT,F.NOTICE_FILE_NM
			FROM NOTICE N JOIN NOTICE_FILE F
			ON N.NOTICE_NO = F.NOTICE_FILE_NO
			WHERE N.NOTICE_NO = #{notice_no}
	</select>
	
	<!-- 파일만 -->
	<select id="getFile" parameterType="Integer" resultType="NoticeFileVo">
		SELECT NOTICE_FILE_NO, NOTICE_FILE_NM, NOTICE_FILE_SAVE_NM, 
						NOTICE_FILE_SIZE, NOTICE_FILE_REG_DT, NOTICE_NO
			FROM NOTICE_FILE
			WHERE NOTICE_FILE_NO = #{notice_file_no}
	</select>
	
	<!-- 총 게시글 갯수 출력 -->
	<select id="countNotice" resultType="Integer">
		SELECT COUNT(*) FROM NOTICE
	</select>
	
	<!-- 페이징 처리 후 게시글 조회 -->
	<select id="selectNotice" resultType="NoticeVo">
		SELECT NOTICE_NO, NOTICE_TITLE, NOTICE_REG_DT,EMP_NO
			FROM (
				SELECT ROWNUM RN, A.* 
					FROM (
							SELECT NOTICE_NO, NOTICE_TITLE, NOTICE_REG_DT,EMP_NO
							FROM NOTICE 
							ORDER BY NOTICE_NO DESC 
							) A
					)
		WHERE RN BETWEEN #{start} AND #{end}
	</select>
</mapper>
